import{r as c,j as t,d as v}from"./app-DyN-wpxS.js";import{c as H,B as y}from"./button-CdyPjVIa.js";import{f as R,e as U,b as G,c as X,d as J}from"./dialog-Y5ccQPmd.js";import{I as K}from"./input-x6uegPVQ.js";import{L as Q}from"./label-DLKOY3Rp.js";import{a as w,q as S}from"./index-DW9AIAM8.js";import{B as O}from"./badge-DvMEEYXx.js";import{I as V}from"./input-error-BQBpUoES.js";import{C as W}from"./checkbox-CA68c0MG.js";import{P as D}from"./plus-ChxiFZ-N.js";import{X as Y}from"./x-lNOBUcxD.js";import{L}from"./loader-circle-B_rqc5mt.js";import{T as Z}from"./trash-2-DUuu_oLz.js";/* empty css            */import"./index-D0w3UerL.js";import"./index-B9ZEsc9v.js";import"./index-B7_9QI6J.js";import"./index-CNe1fd7B.js";import"./index-DjGDGm1v.js";import"./index-pm4w21PO.js";const ee=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],te=H("Search",ee),d=(e,r)=>({url:d.url(e,r),method:"get"});d.definition={methods:["get","head"],url:"/admin/grades/{grade}/students"};d.url=(e,r)=>{(typeof e=="string"||typeof e=="number")&&(e={grade:e}),typeof e=="object"&&!Array.isArray(e)&&"id"in e&&(e={grade:e.id}),Array.isArray(e)&&(e={grade:e[0]}),e=w(e);const n={grade:typeof e.grade=="object"?e.grade.id:e.grade};return d.definition.url.replace("{grade}",n.grade.toString()).replace(/\/+$/,"")+S(r)};d.get=(e,r)=>({url:d.url(e,r),method:"get"});d.head=(e,r)=>({url:d.url(e,r),method:"head"});const k=(e,r)=>({action:d.url(e,r),method:"get"});k.get=(e,r)=>({action:d.url(e,r),method:"get"});k.head=(e,r)=>({action:d.url(e,{[r?.mergeQuery?"mergeQuery":"query"]:{_method:"HEAD",...r?.query??r?.mergeQuery??{}}}),method:"get"});d.form=k;const l=(e,r)=>({url:l.url(e,r),method:"post"});l.definition={methods:["post"],url:"/admin/grades/{grade}/students"};l.url=(e,r)=>{(typeof e=="string"||typeof e=="number")&&(e={grade:e}),typeof e=="object"&&!Array.isArray(e)&&"id"in e&&(e={grade:e.id}),Array.isArray(e)&&(e={grade:e[0]}),e=w(e);const n={grade:typeof e.grade=="object"?e.grade.id:e.grade};return l.definition.url.replace("{grade}",n.grade.toString()).replace(/\/+$/,"")+S(r)};l.post=(e,r)=>({url:l.url(e,r),method:"post"});const q=(e,r)=>({action:l.url(e,r),method:"post"});q.post=(e,r)=>({action:l.url(e,r),method:"post"});l.form=q;const o=(e,r)=>({url:o.url(e,r),method:"delete"});o.definition={methods:["delete"],url:"/admin/grades/{grade}/students/{student}"};o.url=(e,r)=>{Array.isArray(e)&&(e={grade:e[0],student:e[1]}),e=w(e);const n={grade:typeof e.grade=="object"?e.grade.id:e.grade,student:typeof e.student=="object"?e.student.id:e.student};return o.definition.url.replace("{grade}",n.grade.toString()).replace("{student}",n.student.toString()).replace(/\/+$/,"")+S(r)};o.delete=(e,r)=>({url:o.url(e,r),method:"delete"});const F=(e,r)=>({action:o.url(e,{[r?.mergeQuery?"mergeQuery":"query"]:{_method:"DELETE",...r?.query??r?.mergeQuery??{}}}),method:"post"});F.delete=(e,r)=>({action:o.url(e,{[r?.mergeQuery?"mergeQuery":"query"]:{_method:"DELETE",...r?.query??r?.mergeQuery??{}}}),method:"post"});o.form=F;const N={index:d,store:l,destroy:o};function Ne({grade:e,open:r,onOpenChange:n,onStudentAdded:A}){const[u,m]=c.useState(!1),[g,I]=c.useState([]),[b,$]=c.useState([]),[a,f]=c.useState([]),[C,h]=c.useState(null),[x,E]=c.useState(""),j=async()=>{if(e){m(!0),h(null);try{const s=await v.get(N.index(e.id).url);I(s.data.students),$(s.data.available_students)}catch(s){console.error(s),h("Failed to load students.")}finally{m(!1)}}};c.useEffect(()=>{r&&e&&(j(),f([]),E(""))},[r,e]);const z=async()=>{if(!(!e||a.length===0)){m(!0),h(null);try{for(const s of a)await v.post(N.store(e.id).url,{user_id:s});await j(),f([]),A?.()}catch(s){console.error(s),h(s.response?.data?.message||s.response?.data?.errors?.user_id?.[0]||"Failed to assign students.")}finally{m(!1)}}},T=async s=>{if(!(!e||!confirm("Are you sure you want to remove this student?"))){m(!0),h(null);try{await v.delete(N.destroy({grade:e.id,student:s}).url),await j(),A?.()}catch(i){console.error(i),h("Failed to remove student.")}finally{m(!1)}}},B=s=>{f(i=>i.includes(s)?i.filter(_=>_!==s):[...i,s])},M=()=>{f(p.map(s=>s.id))},P=()=>{f([])},p=c.useMemo(()=>{if(!x)return b;const s=x.toLowerCase();return b.filter(i=>i.name.toLowerCase().includes(s)||i.email.toLowerCase().includes(s))},[b,x]);return t.jsx(R,{open:r,onOpenChange:n,children:t.jsxs(U,{className:"sm:max-w-[600px] h-[80vh] flex flex-col rounded-3xl border-none shadow-2xl p-0 gap-0 overflow-hidden",children:[t.jsx("div",{className:"p-6 border-b border-slate-100 dark:border-slate-800 shrink-0",children:t.jsxs(G,{children:[t.jsx(X,{className:"text-xl font-bold",children:"Manage Students"}),t.jsxs(J,{children:["Assign students to ",t.jsx("span",{className:"font-semibold text-primary",children:e?.name}),"."]})]})}),t.jsxs("div",{className:"p-6 flex-1 overflow-y-auto space-y-6",children:[t.jsxs("div",{className:"space-y-4 p-4 bg-slate-50 dark:bg-slate-900/50 rounded-2xl border border-dashed border-slate-200 dark:border-slate-800",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(Q,{className:"text-xs font-bold uppercase tracking-wider text-muted-foreground flex items-center gap-2",children:[t.jsx(D,{className:"size-3"})," Add Students"]}),a.length>0&&t.jsxs(O,{variant:"secondary",className:"rounded-full",children:[a.length," selected"]})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"relative",children:[t.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t.jsx(K,{placeholder:"Search available students...",value:x,onChange:s=>E(s.target.value),className:"pl-9 rounded-xl border-slate-200 bg-white dark:bg-slate-950"})]}),p.length>0&&t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(y,{type:"button",size:"sm",variant:"outline",onClick:M,disabled:u,className:"text-xs rounded-lg",children:["Select All ",x&&`(${p.length})`]}),a.length>0&&t.jsxs(y,{type:"button",size:"sm",variant:"outline",onClick:P,disabled:u,className:"text-xs rounded-lg",children:[t.jsx(Y,{className:"h-3 w-3 mr-1"}),"Clear"]})]}),t.jsx("div",{className:"max-h-[200px] overflow-y-auto border border-slate-200 dark:border-slate-800 rounded-xl",children:p.length>0?t.jsx("div",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:p.map(s=>t.jsxs("label",{className:"flex items-center gap-3 p-3 hover:bg-slate-50 dark:hover:bg-slate-900/50 cursor-pointer transition-colors bg-white dark:bg-slate-950",children:[t.jsx(W,{checked:a.includes(s.id),onCheckedChange:()=>B(s.id),disabled:u}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100 truncate",children:s.name}),t.jsx("div",{className:"text-xs text-muted-foreground truncate",children:s.email})]})]},s.id))}):t.jsx("div",{className:"p-4 text-sm text-center text-muted-foreground bg-white dark:bg-slate-950",children:x?"No matching students found":"No available students"})}),t.jsx(y,{onClick:z,disabled:u||a.length===0,className:"rounded-xl font-bold shadow-md w-full",children:u?t.jsxs(t.Fragment,{children:[t.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Adding..."]}):t.jsxs(t.Fragment,{children:[t.jsx(D,{className:"mr-2 h-4 w-4"}),"Add ",a.length>0?`${a.length} Student${a.length>1?"s":""}`:"Students"]})})]}),C&&t.jsx(V,{message:C})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs(Q,{className:"text-xs font-bold uppercase tracking-wider text-muted-foreground",children:["Assigned Students (",g.length,")"]})}),u&&g.length===0?t.jsx("div",{className:"flex justify-center py-8",children:t.jsx(L,{className:"animate-spin text-muted-foreground"})}):g.length>0?t.jsx("div",{className:"divide-y divide-slate-100 dark:divide-slate-800 border border-slate-100 dark:border-slate-800 rounded-xl overflow-hidden",children:g.map(s=>t.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-slate-50 dark:hover:bg-slate-900/50 transition-colors bg-white dark:bg-slate-950",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-xs",children:s.name.substring(0,2).toUpperCase()}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100",children:s.name}),t.jsx("span",{className:"text-xs text-muted-foreground",children:s.email})]})]}),t.jsx(y,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",onClick:()=>T(s.id),disabled:u,children:t.jsx(Z,{className:"size-4"})})]},s.id))}):t.jsx("div",{className:"text-center py-12 bg-slate-50 dark:bg-slate-900/20 rounded-2xl border border-dashed border-slate-200 dark:border-slate-800",children:t.jsx("p",{className:"text-muted-foreground text-sm",children:"No students assigned to this grade yet."})})]})]})]})})}export{Ne as default};
