import{c as Ee,r as D,j as t,H as Me,b as Be}from"./app-BL23_ioL.js";import{A as He}from"./app-layout-CDpq751G.js";import{b as Te,c as $e,C as ke,a as Le,d as Oe}from"./card-BPYLlYs-.js";import{B as xe}from"./badge-J0MIFrA3.js";import{b as ve,e as L,T as qe,c as A,a as ze,d as Fe}from"./table-DCctSBnV.js";import{B as Re}from"./button-ErPUhfKM.js";import{a as Ue}from"./index-63p2o9N5.js";import{A as Pe}from"./arrow-left-DtOF6xQY.js";import{C as Ie}from"./clock-C56MbyDU.js";import{C as Ve}from"./circle-check-big-Y3jfL0jT.js";import{C as We}from"./circle-x-Du51Wy4n.js";import{T as Ae}from"./timer-QIUeZQvF.js";import{a as Je}from"./differenceInSeconds-BQJbCe2m.js";/* empty css            */import"./app-sidebar-layout-BQteZuDl.js";import"./app-shell-jJUctm17.js";import"./sheet-CAKOvksQ.js";import"./index-CuzgK42c.js";import"./index-DuTHxAZ2.js";import"./index-DFAfDP5U.js";import"./index-BoQRUedT.js";import"./x-Bvzm8Mbo.js";import"./index-CneOgjps.js";import"./index-Uqd2XL9l.js";import"./dropdown-menu-CNt4bR-q.js";import"./index-CQgWKaQN.js";import"./index-e0nZHYEA.js";import"./index-CCL8Hooa.js";import"./index-63gOiuA7.js";import"./index-DW9AIAM8.js";import"./settings-xNbhH6pj.js";import"./index-CO7HXDK1.js";import"./app-logo-icon-Cc_kpyVd.js";import"./users-BFSadU9h.js";import"./calendar-DOhSzEfG.js";import"./index-C3I_bb3G.js";import"./toDate-DPY-_nel.js";const Xe=j=>{const e=Ee.c(14),{startTime:s,durationMinutes:M,timerType:_,isFinished:f,finalDurationSeconds:b}=j,[E,B]=D.useState(0);let w,h;e[0]!==f||e[1]!==s?(w=()=>{if(f||!s)return;const i=()=>{const x=new Date,u=new Date(s),p=Je(x,u);B(p)};i();const c=setInterval(i,1e3);return()=>clearInterval(c)},h=[s,f],e[0]=f,e[1]=s,e[2]=w,e[3]=h):(w=e[2],h=e[3]),D.useEffect(w,h);const ue=Ke;if(!s){let i;return e[4]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx("span",{className:"text-muted-foreground",children:"-"}),e[4]=i):i=e[4],i}if(f){const i=ue(b);let c;return e[5]!==i?(c=t.jsx("span",{className:"font-mono",children:i}),e[5]=i,e[6]=c):c=e[6],c}if(_==="flexible"){let i;e[7]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx(Ae,{className:"w-3 h-3"}),e[7]=i):i=e[7];const c=ue(E);let x;return e[8]!==c?(x=t.jsxs("div",{className:"flex items-center gap-1 font-mono text-blue-600",children:[i,c]}),e[8]=c,e[9]=x):x=e[9],x}else{const c=M*60-E,u=`flex items-center gap-1 font-mono ${c<300?"text-red-600 animate-pulse":"text-orange-600"}`;let p;e[10]===Symbol.for("react.memo_cache_sentinel")?(p=t.jsx(Ie,{className:"w-3 h-3"}),e[10]=p):p=e[10];const S=ue(c);let l;return e[11]!==u||e[12]!==S?(l=t.jsxs("div",{className:u,children:[p,S]}),e[11]=u,e[12]=S,e[13]=l):l=e[13],l}};function Dt(j){const e=Ee.c(125),{exam:s,initialStudents:M}=j;let _;e[0]===Symbol.for("react.memo_cache_sentinel")?(_={title:"Exam Management",href:Ue.url()},e[0]=_):_=e[0];const f=`/admin/exams/${s.id}/monitor`;let b;e[1]!==f?(b={title:"Monitor",href:f},e[1]=f,e[2]=b):b=e[2];let E;e[3]===Symbol.for("react.memo_cache_sentinel")?(E={title:"Live Score",href:"#"},e[3]=E):E=e[3];let B;e[4]!==b?(B=[_,b,E],e[4]=b,e[5]=B):B=e[5];const w=B,[h,ue]=D.useState(M),[i,c]=D.useState(!1);let x;e[6]===Symbol.for("react.memo_cache_sentinel")?(x=new Set,e[6]=x):x=e[6];const[u,p]=D.useState(x);let S;e[7]===Symbol.for("react.memo_cache_sentinel")?(S={key:"score_current",direction:"desc"},e[7]=S):S=e[7];const[l,De]=D.useState(S);let he,pe;e[8]!==s.id?(he=()=>{const g=`exam.monitor.${s.id}`;if(console.log(`Subscribing to channel: ${g}`),!window.Echo)return;window.Echo.private(g).listen(".student.progress",n=>{const r=n.data,d=n.studentId;ue(k=>{const m=k.findIndex(a=>a.user_id===d);if(m!==-1){const a=[...k];return a[m]={...a[m],correct_count:r.correct_count,wrong_count:r.wrong_count,total_answered:r.total_answered,total_questions:r.total_questions,duration_seconds:r.duration_seconds,score_current:r.score_current,student_name:r.student_name??a[m].student_name,is_finished:r.is_finished??a[m].is_finished,start_time:r.start_time??a[m].start_time},a}else{const a={id:"unknown-session",user_id:d,student_name:r.student_name??"Unknown",student_email:"",correct_count:r.correct_count,wrong_count:r.wrong_count,total_answered:r.total_answered,total_questions:r.total_questions,duration_seconds:r.duration_seconds,score_current:r.score_current,is_finished:r.is_finished??!1,start_time:r.start_time??new Date().toISOString()};return[...k,a]}})}).subscribed(()=>{c(!0)}).error(n=>{console.error("Subscription error:",n),c(!1)});const $=`exam.presence.${s.id}`;return window.Echo.join($).here(n=>{console.log("Here users:",n);const r=new Set(n.map(Ge));p(r)}).joining(n=>{console.log("Joining:",n),p(r=>{const d=new Set(r);return d.add(String(n.id)),d})}).leaving(n=>{console.log("Leaving:",n),p(r=>{const d=new Set(r);return d.delete(String(n.id)),d})}),()=>{console.log(`Leaving channel: ${g}`),window.Echo.leave(g),console.log(`Leaving channel: ${$}`),window.Echo.leave($)}},pe=[s.id],e[8]=s.id,e[9]=he,e[10]=pe):(he=e[9],pe=e[10]),D.useEffect(he,pe);let H,O,q,z,F,R,U,N,P,v,V,y,C,W,T;if(e[11]!==w||e[12]!==s.duration||e[13]!==s.id||e[14]!==s.timer_type||e[15]!==s.title||e[16]!==i||e[17]!==u||e[18]!==l||e[19]!==h){let g;e[35]!==l?(g=(o,I)=>{if(!l)return 0;const ye=o[l.key],Ce=I[l.key];return ye<Ce?l.direction==="asc"?-1:1:ye>Ce?l.direction==="asc"?1:-1:0},e[35]=l,e[36]=g):g=e[36];const Ne=[...h].sort(g);let $;e[37]!==l?($=o=>{let I="desc";l&&l.key===o&&l.direction==="desc"&&(I="asc"),De({key:o,direction:I})},e[37]=l,e[38]=$):$=e[38];const n=$;F=He,W=w;const r=`Live Score - ${s.title}`;e[39]!==r?(T=t.jsx(Me,{title:r}),e[39]=r,e[40]=T):T=e[40],V="flex flex-col gap-6 p-6";let d;e[41]!==s.id?(d=()=>Be.visit(`/admin/exams/${s.id}/monitor`),e[41]=s.id,e[42]=d):d=e[42];let k;e[43]===Symbol.for("react.memo_cache_sentinel")?(k=t.jsx(Pe,{className:"h-4 w-4"}),e[43]=k):k=e[43];let m;e[44]!==d?(m=t.jsx(Re,{variant:"outline",size:"icon",onClick:d,children:k}),e[44]=d,e[45]=m):m=e[45];let a;e[46]!==s.title?(a=t.jsxs("h1",{className:"text-2xl font-bold tracking-tight text-slate-900 dark:text-slate-100",children:["Live Score: ",s.title]}),e[46]=s.title,e[47]=a):a=e[47];let Z;e[48]!==s.timer_type?(Z=s.timer_type==="flexible"?t.jsx(xe,{variant:"secondary",className:"bg-blue-100 text-blue-700 hover:bg-blue-100",children:"Flexible Timer"}):t.jsx(xe,{variant:"secondary",className:"bg-orange-100 text-orange-700 hover:bg-orange-100",children:"Strict Timer"}),e[48]=s.timer_type,e[49]=Z):Z=e[49];let ee;e[50]!==s.duration?(ee=t.jsxs("span",{children:["Duration: ",s.duration,"m"]}),e[50]=s.duration,e[51]=ee):ee=e[51];let te;e[52]!==i?(te=i?t.jsx(xe,{variant:"outline",className:"border-green-500 text-green-500 bg-green-50 animate-pulse ml-2",children:"Live Connected"}):t.jsx(xe,{variant:"outline",className:"border-yellow-500 text-yellow-500 bg-yellow-50 ml-2",children:"Connecting..."}),e[52]=i,e[53]=te):te=e[53];let se;e[54]!==Z||e[55]!==ee||e[56]!==te?(se=t.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground font-medium text-sm mt-1",children:[Z,ee,te]}),e[54]=Z,e[55]=ee,e[56]=te,e[57]=se):se=e[57];let ne;e[58]!==a||e[59]!==se?(ne=t.jsxs("div",{children:[a,se]}),e[58]=a,e[59]=se,e[60]=ne):ne=e[60],e[61]!==m||e[62]!==ne?(y=t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center gap-4",children:[m,ne]})}),e[61]=m,e[62]=ne,e[63]=y):y=e[63];let ge;e[64]===Symbol.for("react.memo_cache_sentinel")?(ge=t.jsxs(Te,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx($e,{className:"text-sm font-medium",children:"Active Students"}),t.jsx(Ie,{className:"h-4 w-4 text-muted-foreground"})]}),e[64]=ge):ge=e[64];let re;e[65]!==h.length?(re=t.jsx("div",{className:"text-2xl font-bold",children:h.length}),e[65]=h.length,e[66]=re):re=e[66];let ie;e[67]!==u.size?(ie=t.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Online: ",u.size]}),e[67]=u.size,e[68]=ie):ie=e[68],e[69]!==re||e[70]!==ie?(C=t.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:t.jsxs(ke,{children:[ge,t.jsxs(Le,{children:[re,ie]})]})}),e[69]=re,e[70]=ie,e[71]=C):C=e[71],z=ke,e[72]===Symbol.for("react.memo_cache_sentinel")?(v=t.jsxs(Te,{children:[t.jsx($e,{children:"Leaderboard (Live)"}),t.jsx(Oe,{children:"Sorted by Answered Count initially. Click headers to sort."})]}),e[72]=v):v=e[72],q=Le,P="rounded-md border",O=qe,U="min-w-[1000px]";let je;e[73]===Symbol.for("react.memo_cache_sentinel")?(je=t.jsx(A,{children:"Status"}),e[73]=je):je=e[73];let le;e[74]!==n?(le=t.jsx(A,{className:"cursor-pointer",onClick:()=>n("student_name"),children:"Student Name"}),e[74]=n,e[75]=le):le=e[75];let oe;e[76]!==n?(oe=t.jsx(A,{className:"cursor-pointer text-center",onClick:()=>n("total_answered"),children:"Progress"}),e[76]=n,e[77]=oe):oe=e[77];let ae;e[78]!==n?(ae=()=>n("correct_count"),e[78]=n,e[79]=ae):ae=e[79];let be;e[80]===Symbol.for("react.memo_cache_sentinel")?(be=t.jsxs("div",{className:"flex items-center justify-center gap-1",children:[t.jsx(Ve,{className:"w-4 h-4 text-green-500"})," Correct"]}),e[80]=be):be=e[80];let ce;e[81]!==ae?(ce=t.jsx(A,{className:"cursor-pointer text-center",onClick:ae,children:be}),e[81]=ae,e[82]=ce):ce=e[82];let de;e[83]!==n?(de=()=>n("wrong_count"),e[83]=n,e[84]=de):de=e[84];let we;e[85]===Symbol.for("react.memo_cache_sentinel")?(we=t.jsxs("div",{className:"flex items-center justify-center gap-1",children:[t.jsx(We,{className:"w-4 h-4 text-red-500"})," Wrong"]}),e[85]=we):we=e[85];let me;e[86]!==de?(me=t.jsx(A,{className:"cursor-pointer text-center",onClick:de,children:we}),e[86]=de,e[87]=me):me=e[87];let fe;e[88]!==n?(fe=t.jsx(A,{className:"cursor-pointer text-center",onClick:()=>n("score_current"),children:"Score"}),e[88]=n,e[89]=fe):fe=e[89];let Se;e[90]===Symbol.for("react.memo_cache_sentinel")?(Se=t.jsx(A,{className:"cursor-pointer text-right w-[150px]",children:t.jsxs("div",{className:"flex items-center justify-end gap-1",children:[t.jsx(Ae,{className:"w-4 h-4"})," Time"]})}),e[90]=Se):Se=e[90],e[91]!==le||e[92]!==oe||e[93]!==ce||e[94]!==me||e[95]!==fe?(N=t.jsx(ze,{children:t.jsxs(ve,{children:[je,le,oe,ce,me,fe,Se]})}),e[91]=le,e[92]=oe,e[93]=ce,e[94]=me,e[95]=fe,e[96]=N):N=e[96],H=Fe,R=Ne.length===0?t.jsx(ve,{children:t.jsx(L,{colSpan:7,className:"text-center h-24 text-muted-foreground",children:"Waiting for students to start..."})}):Ne.map(o=>{const I=u.has(String(o.user_id));return t.jsxs(ve,{className:o.is_finished?"bg-slate-50 dark:bg-slate-900/50":"",children:[t.jsx(L,{className:"w-[50px] text-center",children:t.jsx("div",{className:`w-3 h-3 rounded-full mx-auto ${I?"bg-green-500 animate-pulse":"bg-slate-300"}`,title:I?"Online":"Offline"})}),t.jsx(L,{className:"font-medium",children:t.jsxs("div",{className:"flex items-center gap-2",children:[o.student_name,o.is_finished&&t.jsx(xe,{variant:"default",className:"bg-green-600 hover:bg-green-700 text-white text-[10px] px-1 py-0 h-5",children:"Selesai"})]})}),t.jsx(L,{className:"text-center",children:t.jsxs(xe,{variant:"outline",children:[o.total_answered," / ",o.total_questions]})}),t.jsx(L,{className:"text-center text-green-600 font-bold",children:o.correct_count}),t.jsx(L,{className:"text-center text-red-600 font-bold",children:o.wrong_count}),t.jsx(L,{className:"text-center font-mono",children:o.score_current}),t.jsx(L,{className:"text-right",children:t.jsx(Xe,{startTime:o.start_time,durationMinutes:s.duration,timerType:s.timer_type,isFinished:o.is_finished,finalDurationSeconds:o.duration_seconds})})]},o.user_id)}),e[11]=w,e[12]=s.duration,e[13]=s.id,e[14]=s.timer_type,e[15]=s.title,e[16]=i,e[17]=u,e[18]=l,e[19]=h,e[20]=H,e[21]=O,e[22]=q,e[23]=z,e[24]=F,e[25]=R,e[26]=U,e[27]=N,e[28]=P,e[29]=v,e[30]=V,e[31]=y,e[32]=C,e[33]=W,e[34]=T}else H=e[20],O=e[21],q=e[22],z=e[23],F=e[24],R=e[25],U=e[26],N=e[27],P=e[28],v=e[29],V=e[30],y=e[31],C=e[32],W=e[33],T=e[34];let J;e[97]!==H||e[98]!==R?(J=t.jsx(H,{children:R}),e[97]=H,e[98]=R,e[99]=J):J=e[99];let X;e[100]!==O||e[101]!==U||e[102]!==N||e[103]!==J?(X=t.jsxs(O,{className:U,children:[N,J]}),e[100]=O,e[101]=U,e[102]=N,e[103]=J,e[104]=X):X=e[104];let G;e[105]!==P||e[106]!==X?(G=t.jsx("div",{className:P,children:X}),e[105]=P,e[106]=X,e[107]=G):G=e[107];let K;e[108]!==q||e[109]!==G?(K=t.jsx(q,{children:G}),e[108]=q,e[109]=G,e[110]=K):K=e[110];let Q;e[111]!==z||e[112]!==v||e[113]!==K?(Q=t.jsxs(z,{children:[v,K]}),e[111]=z,e[112]=v,e[113]=K,e[114]=Q):Q=e[114];let Y;e[115]!==V||e[116]!==y||e[117]!==C||e[118]!==Q?(Y=t.jsxs("div",{className:V,children:[y,C,Q]}),e[115]=V,e[116]=y,e[117]=C,e[118]=Q,e[119]=Y):Y=e[119];let _e;return e[120]!==F||e[121]!==W||e[122]!==T||e[123]!==Y?(_e=t.jsxs(F,{breadcrumbs:W,children:[T,Y]}),e[120]=F,e[121]=W,e[122]=T,e[123]=Y,e[124]=_e):_e=e[124],_e}function Ge(j){return String(j.id)}function Ke(j){const e=j<0?"-":"",s=Math.abs(j),M=Math.floor(s/3600),_=Math.floor(s%3600/60),f=s%60;return M>0?`${e}${M}h ${_}m ${f}s`:`${e}${_}m ${f}s`}export{Dt as default};
